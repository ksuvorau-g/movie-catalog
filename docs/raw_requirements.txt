MOVIE CATALOG - RAW REQUIREMENTS
=================================

PROJECT OVERVIEW
-----------------
A REST API service for managing a personal movie and TV series catalog. The system allows users to track movies they want to watch, mark them as watched or unwatched, get recommendations for what to watch next, and track TV series progress with automatic notifications for new season releases.


CORE FEATURES
-------------

1. ADD NEW MOVIE
   - Users can add a new movie to their catalog
   - Each movie entry must include:
     * Title
     * Link (URL where the movie can be accessed)
     * Text comment (personal notes or review)
     * Cover image link (URL to movie poster/thumbnail)
     * Length (duration of the movie)
     * Genre
   
2. MARK MOVIE AS WATCHED/UNWATCHED
   - Users can mark any movie in their catalog as "watched"
   - Users can change the status back to "unwatched" if needed
   - The system should track the current watch status of each movie

2a. SET MOVIE/SERIES PRIORITY
   - Users can manually increase or decrease priority for any movie or series
   - Priority is a numeric value (higher = more likely to be recommended)
   - Default priority is 0
   - Priority can be adjusted through API to boost specific content in recommendations

3. GET MOVIE RECOMMENDATION
   - Users can request a recommendation for the next movie to watch
   - Recommendation logic:
     * Both movies and TV series are included in recommendations
     * For movies: Only unwatched movies are considered
     * For series: Only series with unwatched seasons are considered
     * Probability is weighted by how long ago the movie/series was added (older items have higher probability)
     * Manual priority can be set through API to boost specific movies/series (higher priority = higher chance)
     * Special case for series: If all previously available seasons were watched and new season(s) were added, series gets very high probability to appear on top
     * Random selection applied with the age-based weighting (except for series with new seasons which have priority)
     * Example: A movie/series added a year ago has higher chance than one added yesterday
     * Example priority: High manual priority > Series with new seasons > Old unwatched items > Recently added unwatched items

4. RETRIEVE FULL CATALOG LIST
   - Users can get a complete list of all movies and TV series in their catalog
   - List capabilities:
     * Filtering: Support filtering by:
       - Genre, watch status, added by (person name)
       - Content type (movies only, series only, or both)
       - Series-specific: series with new unwatched seasons, complete vs. ongoing series
     * Sorting: 
       - All unwatched movies and series ALWAYS appear first in the catalog, regardless of other sorting criteria
       - Support sorting by title, length (for movies), date added (applied within unwatched/watched groups)
       - Default sort: unwatched items first, then by priority (higher values first), then by date added (older items first)
     * Pagination: Optional feature that can be implemented if needed for large catalogs

5. ADD NEW TV SERIES
   - Users can add a TV series to their catalog
   - Each series entry must include at least a title
   - Series can include the same optional fields as movies (link, description, comment, cover image, genre, added by)
   - Series have additional tracking for season progress
   - Seasons can be added during creation or added later individually
   - Each season has a season number and watch status (WATCHED/UNWATCHED)
   
   METHODS TO ADD SERIES:
   a) WITH INITIAL SEASONS:
      - Include seasons array in POST request
      - Each season requires: seasonNumber (Integer) and watchStatus (WATCHED/UNWATCHED)
      - Example: Create "Breaking Bad" with seasons 1-5, where 1-3 are watched
      
   b) WITHOUT SEASONS (ADD LATER):
      - Create series with only title and metadata
      - Add seasons progressively using PATCH endpoint for each season
      - Useful when you don't know total season count upfront
      
   c) WITH EXTERNAL LINK:
      - Provide IMDB or Kinopoisk URL in 'link' field
      - Trigger manual refresh to auto-fetch season information
      - System will populate seasons from external source

6. MARK SERIES SEASON AS WATCHED/UNWATCHED
   - Users can mark individual seasons as watched or unwatched
   - Users can mark an entire series as watched (all seasons marked as watched)
   - Users can mark an entire series as unwatched (all seasons marked as unwatched)
   - Series watch status is automatically determined:
     * Series is "watched" if all available seasons are marked as watched
     * Series is "unwatched" if any season is marked as unwatched
   - Users can skip seasons (e.g., mark Season 3 as watched without watching Season 2)
   - No episode-level tracking - seasons are marked manually as a whole
   
   SEASON MANAGEMENT OPERATIONS:
   a) MARK INDIVIDUAL SEASON:
      - PATCH /api/series/{id}/seasons/{seasonNumber}/watch-status
      - If season doesn't exist, it's created automatically
      - Updates series watch status after change
      
   b) MARK ALL SEASONS (BULK):
      - PATCH /api/series/{id}/watch-status
      - Updates ALL existing seasons to specified status
      - Does not create new seasons
      - Useful for: completed series, rewatching entire series
      
   c) REPLACE SEASONS ENTIRELY:
      - PUT /api/series/{id} with seasons array
      - Replaces all existing seasons with new array
      - Useful for: restructuring season list, importing from external source
      
   d) ADD SEASONS PROGRESSIVELY:
      - PATCH individual seasons one by one
      - Each PATCH creates season if it doesn't exist
      - Useful for: tracking as you watch, discovering new seasons

7. AUTOMATIC SEASON REFRESH AND NOTIFICATIONS
   - System periodically checks for new seasons (e.g., weekly)
   - System fetches latest season information from external sources
   - Notifications are displayed when new seasons are detected for series where at least one season has been watched
   - Notifications persist until manually dismissed by the user
   - Notifications inform user which series has new seasons available
   - If external source is unavailable:
     * System retries in one hour
     * User can manually trigger a refresh check


DATA ATTRIBUTES
---------------

MOVIES:
Each movie in the catalog contains:
- Title: Name of the movie [REQUIRED]
- Link: URL where the movie can be accessed/watched [OPTIONAL]
- Comment: User's personal notes, thoughts, or review [OPTIONAL]
- Cover Image: URL to the movie poster or thumbnail image [OPTIONAL]
- Length: Duration of the movie (in minutes) [OPTIONAL]
- Genre: Movie categories/types - can have multiple genres, free text [OPTIONAL]
- Watch Status: Tracked automatically (watched/unwatched)
- Added By: Name of the person who added this movie to the catalog [OPTIONAL]
- Date Added: Automatically tracked when movie is added to the catalog
- Priority: Numeric value for manual recommendation priority adjustment [OPTIONAL, default: 0]

TV SERIES:
Each TV series in the catalog contains:
- Title: Name of the series [REQUIRED]
- Link: URL where the series can be accessed/watched [OPTIONAL]
- Comment: User's personal notes, thoughts, or review [OPTIONAL]
- Cover Image: URL to the series poster or thumbnail image [OPTIONAL]
- Genre: Series categories/types - can have multiple genres, free text [OPTIONAL]
- Seasons: Collection of seasons with watch status for each [OPTIONAL - can be empty]
  * Season Number: Number identifier for the season (1, 2, 3, etc.)
  * Watch Status: Watched or unwatched for each season
  * Can be marked individually or all at once
  * Can be provided during creation or added later
  * No season order enforcement - can skip seasons
- Series Watch Status: Automatically calculated (watched if all seasons watched, unwatched otherwise) [AUTOMATIC]
- Total Available Seasons: Total number of seasons available (fetched from external source) [AUTOMATIC]
- Has New Seasons: Flag indicating if new unwatched seasons are available [AUTOMATIC]
- Series Status: Complete or ongoing (fetched from external source) [AUTOMATIC]
- Added By: Name of the person who added this series to the catalog [OPTIONAL]
- Date Added: Automatically tracked when series is added to the catalog [AUTOMATIC]
- Last Season Check: Date when system last checked for new seasons [AUTOMATIC]
- Priority: Numeric value for manual recommendation priority adjustment [OPTIONAL, default: 0]

SEASON DATA STRUCTURE:
Each season is an embedded object (not a separate collection) containing:
- seasonNumber: Integer (1, 2, 3, etc.) [REQUIRED]
- watchStatus: Enum ("WATCHED" or "UNWATCHED") [REQUIRED, default: UNWATCHED]

SERIES API REQUEST/RESPONSE FORMAT:

CREATE SERIES (POST /api/series):
{
  "title": "Breaking Bad",                    // REQUIRED
  "link": "https://imdb.com/title/...",      // OPTIONAL
  "comment": "Personal notes",                // OPTIONAL
  "coverImage": "/api/images/{id}",          // OPTIONAL
  "genres": ["Crime", "Drama"],              // OPTIONAL
  "seasons": [                               // OPTIONAL
    {"seasonNumber": 1, "watchStatus": "WATCHED"},
    {"seasonNumber": 2, "watchStatus": "UNWATCHED"}
  ],
  "addedBy": "John",                         // OPTIONAL
  "priority": 5                              // OPTIONAL
}

SERIES RESPONSE (GET/POST/PUT/PATCH):
{
  "id": "507f1f77bcf86cd799439011",
  "title": "Breaking Bad",
  "link": "https://imdb.com/title/...",
  "comment": "Personal notes",
  "coverImage": "/api/images/{id}",
  "genres": ["Crime", "Drama"],
  "seasons": [
    {"seasonNumber": 1, "watchStatus": "WATCHED"},
    {"seasonNumber": 2, "watchStatus": "UNWATCHED"}
  ],
  "watchStatus": "UNWATCHED",          // AUTO-CALCULATED
  "totalAvailableSeasons": 5,                // FROM EXTERNAL SOURCE
  "hasNewSeasons": true,                     // AUTO-CALCULATED
  "seriesStatus": "COMPLETE",                // FROM EXTERNAL SOURCE
  "addedBy": "John",
  "dateAdded": "2025-11-14T10:30:00",       // AUTO-GENERATED
  "lastSeasonCheck": "2025-11-14T10:30:00", // AUTO-UPDATED
  "priority": 5
}


USER CONTEXT
------------
- Single-user system (personal movie catalog)
- No authentication required
- When adding a movie, user can optionally specify the name of the person who added it
- Movies can be filtered by the "added by" field to see who contributed which movies


DATA MANAGEMENT
---------------
- Duplicate Prevention: 
  * System should allow adding movies/series with duplicate titles
  * System should warn the user when adding a movie/series with an existing title
  * Future enhancement: Ability to merge duplicate records

- Edit Capability: Users can edit movie/series information after adding it

- Delete Capability: Users can delete movies/series from the catalog

- Search Functionality: Users can search for specific movies/series by title or other attributes

- Notifications:
  * System displays notifications when new seasons are detected for tracked series
  * Notifications only shown for series where at least one season has been watched
  * Notifications persist until manually dismissed by the user
  * Notifications should indicate which series has new seasons and how many
  * Users can dismiss individual notifications

- External Source Refresh:
  * Automatic periodic checks (e.g., weekly)
  * Manual refresh option available for users
  * Retry logic: If external source fails, retry in one hour


FUTURE ENHANCEMENTS
-------------------
- Fetch additional movie information automatically from external sources (IMDB, Kinopoisk)
- Merge duplicate movie/series records
- Implement pagination for large catalogs
- Add movie/series rating functionality
- Track date when movie was watched
- Track individual episode progress within seasons
- Customizable refresh frequency for season checks
- Email or push notifications for new seasons (in addition to in-app notifications)


SUMMARY OF KEY DECISIONS
-------------------------
✓ System supports both movies and TV series in a unified catalog
✓ Only title is required for both movies and series; all other fields are optional
✓ Movies can have multiple genres (free text); same for series
✓ System allows duplicates but warns the user
✓ Single-user system with optional "added by" field for tracking contributors
✓ Recommendation includes both movies and series, based on weighted random selection favoring older unwatched items
✓ Manual priority can be set for movies/series to influence recommendation probability
✓ For series recommendations: only series with unwatched seasons are included
✓ Series with newly released seasons (where previous seasons were watched) get very high priority in recommendations
✓ Full filtering and sorting capabilities for catalog list (movies and series combined)
✓ Catalog sorting: unwatched items always appear first, then by priority (higher first), then by date added (older first) as default
✓ Series-specific filters: new unwatched seasons, complete vs. ongoing status
✓ Series track season-by-season watch status (manual marking, no episode tracking)
✓ Series can be marked individually by season or all at once
✓ Users can skip seasons when marking as watched
✓ Series watch status automatically calculated based on all seasons
✓ System automatically checks for new seasons periodically (e.g., weekly)
✓ Notifications persist until dismissed and only shown for series with at least one watched season
✓ Failed external source checks retry in one hour; manual refresh available


OPEN QUESTIONS FOR PRODUCT OWNER
---------------------------------
1. What should drive the movie recommendation logic?
2. What filtering and sorting options are needed for the movie list?
3. Should a movie support multiple genres or just one?
4. Is this a single-user or multi-user system?
5. Should the system prevent duplicate movie entries?
6. Do we need edit and delete capabilities for movies?
7. Which movie attributes are mandatory vs optional?
8. Should there be search functionality to find specific movies?
9. Are there any constraints on data formats (URL validation, length format, etc.)?
10. Should the system track any additional information (date added, date watched, rating)?
